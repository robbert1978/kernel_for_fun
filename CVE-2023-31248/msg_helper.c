#include "msg_helper.h"
#include <stdio.h>
#include <stdlib.h>

void static panic(const char *msg) {
  perror(msg);
  _Exit(1);
}

#define msgsend(size)                                                          \
  void msgsend##size(int qid, struct msgmsg##size *msg, int num,               \
                     char pattern) {                                           \
    if (pattern)                                                               \
      memset(&msg->mtext, pattern, sizeof(msg->mtext));                        \
    for (int ix = 0; ix != num; ++ix) {                                        \
      if (msgsnd(qid, msg, sizeof(*msg) - sizeof(long), 0) < 0)                \
        panic("msgsnd");                                                       \
    }                                                                          \
  }

msgsend(64);
msgsend(96);
msgsend(128);
msgsend(1024);