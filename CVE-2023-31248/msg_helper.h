#include <stdint.h>
#include <string.h>
#include <sys/msg.h>

struct msg_msg {
  uint64_t m_list_next;
  uint64_t m_list_prev;
  uint64_t m_type;
  uint64_t m_ts;
  uint64_t next;
  uint64_t security;
};

struct msg_msgseg {
  uint64_t next;
};

#define MSGMSG_HEADER_SIZE sizeof(struct msg_msg)
#define MSG_MSGSEG_SIZE sizeof(struct msg_msgseg)

#define DATALEN_MSG (0x1000ULL - MSGMSG_HEADER_SIZE)

#define msgmsg(size)                                                           \
  struct msgmsg##size {                                                        \
    long mtype;                                                                \
    char mtext[size - MSGMSG_HEADER_SIZE];                                     \
  };                                                                           \
  extern void msgsend##size(int qid, struct msgmsg##size *msg, int num,        \
                            char pattern);
msgmsg(64);
msgmsg(96);
msgmsg(128);
msgmsg(1024);
